import flet as ft
import mysql.connector

#--Importar la herramienta de gestión de clientes
from usuario import Herramienta_Usuario

def connect_to_db():
    try:
        connection = mysql.connector.connect(
            host="localhost",
            port=3306,
            user="root",
            password="root",
            database="Taller_Mecanico",
            ssl_disabled=True
        )
        if connection.is_connected():
            print('Conexión exitosa')
            return connection
    except Exception as ex:
        print('Conexión errónea')
        print(ex)
        return None

connection = connect_to_db()

def menu_principal(page: ft.Page):
    page.clean()
    page.window.maximized = True
    page.title = "Administración de Taller Mecánico"

    cliente_icono = ft.Image(src="iconos/usuario.png", width=28, height=28)
    cliente_item = ft.Row(
        controls=[cliente_icono, ft.Text("Cliente")],
        alignment=ft.MainAxisAlignment.START,
        spacing=8
    )

    herramientas_menu = ft.PopupMenuButton(
        items=[
            ft.PopupMenuItem(content=cliente_item, on_click=lambda e: cliente(e, page)),
        ],
        content=ft.Text("Herramientas"), tooltip="Administrador de archivos maestros"
    )

    boton_cliente = ft.IconButton(content=cliente_icono, tooltip="Cliente", on_click=lambda e: cliente(e, page))

    page.add(
        ft.Row(controls=[herramientas_menu], spacing=10),
        ft.Row(controls=[boton_cliente])
    )

def cliente(e, page: ft.Page):
    Herramienta_Usuario(page, menu_principal)

def main(page: ft.Page):
    page.window.maximized = True
    page.add(ft.Text("Probando que Flet cargue..."))
    menu_principal(page)

ft.app(target=main)
